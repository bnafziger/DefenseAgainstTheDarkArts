<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1"/>
<link rel="stylesheet" href="../stylesheets/style.css" />
<title>COMP 116: Introduction to Computer Security - Assignment 2</title>
</head>

<body>
<h1>COMP 116: Introduction to Computer Security, Fall 2015</h1>
<h2>Assignment 2: The Incident Alarm</h2>
<h2>Due: Tuesday, October 13th</h2>

<h2>Objectives</h2>
<ol>
	<li>Write a tool to analyze a live stream of network packets for incidents.</li>
	<li>Learn how to parse and dissect network packets programmatically.</li>
	<li>Learn how to read and analyze a log for incidents.</li>
	<li>Learn Ruby and regular expressions (for those who do not know already).</li>
</ol>

<h2>Overview</h2>
<p>We discussed a number of network scanning techniques , and you practiced finding sensitive information in PCAP files in the first assignment.  In this assignment, you will apply your knowledge to write a tool that provides notification of incidents on a computer via a live stream of network packets or via a web server log.</p>
<p><code>PacketFu</code> is a mid-level packet manipulation library for Ruby written by Tod Beardsley.  You can write programs for reading and writing packets to a network interface or to a libpcap-formatted file.  <code>PacketFu</code> is currently used in the <a href="https://github.com/rapid7/metasploit-framework" target="_blank">Metasploit Project</a>.  Read <a href="manipulatingthenetworkwithpacketfu-110314111058-phpapp01.pdf"><span class="title">Manipulating The Network with PacketFu</span> (from Hakin9 Magazine, February 2010)</a> on how to perform ARP spoofing with <code>PacketFu</code>.</p>

<h2>Instructions</h2>
<p>Using Ruby and the <code>PacketFu</code> gem, you will write a program named <code>alarm.rb</code> that provides user the option to (1) analyze live stream of network packets or (2) a web server log for incidents.</p>

<h3>Anaylzing Live Stream of Network Packets</h3>
<p>Your program shall be able to analyze a live stream of network packets for the following incidents:</p>
<ol>
	<li>NULL scan</li>
	<li>FIN scan</li>
	<li>Xmas scan</li>
	<li>Other Nmap scans</li>
	<li>Nikto scan</li>
	<li>Credit card leak</li>
</ol>

<p>If an incident is detected, alert must be displayed in the format:</p>
<p><code>#{incident_number}. ALERT: #{incident} is detected from #{source IP address} (#{protocol}) (#{payload})!</code></p>
<p>Examples:</p>
<ol>
	<li><code>ALERT: NULL scan is detected from 192.168.1.3 (UDP) (<em>binary data</em>)!</code></li>
 	<li><code>ALERT: Credit card leaked in the clear from 192.168.1.7 (HTTP) (<em>binary data</em>)!</code></li>
</ol>
<p>Alert message can be displayed multiple times for a source IP address (e.g., from an XMAS scan).</p>
<p>Your program does not need to support reading PCAP files, saving the stream of packets to a PCAP file, or saving a record of detected incidents.  This will be extra credit.</p>

<h3>Anaylzing Web Server Log</h3>
<p>You do not need to use <code>PacketFu</code> to do this!</p>
<p>Your program shall be able to read a web server log and analyze it for the following incidents:</p>
<ul>
	<li>NMAP scan (of any variety)</li>
	<li>Nikto scan</li>
	<li>Someone running Rob Graham's Masscan</li>
	<li>Someone scanning for Shellshock vulnerability. For background reading on the Shellshock bug, read <a href="http://www.troyhunt.com/2014/09/everything-you-need-to-know-about.html" target="_blank">http://www.troyhunt.com/2014/09/everything-you-need-to-know-about.html</a></li>
	<li>Anything pertaining to <code>phpMyAdmin</code></li>
	<li>Anything that looks like shellcode.  For some background reading on shellcode and what it is, read <a href="https://morgawr.github.io/hacking/2014/03/29/shellcode-to-reverse-bind-with-netcat/" target="_blank">https://morgawr.github.io/hacking/2014/03/29/shellcode-to-reverse-bind-with-netcat/</a></li>
</ul>

<p>If an incident is detected, alert must be displayed in the format:</p>
<p><code>#{incident_number}. ALERT: #{incident} is detected from #{source IP address} (#{protocol}) (#{payload})!</code></p>
<p>Example:</p>
<ol>
	<li><code>ALERT: Someone looking for phpMyAdmin stuff is detected from 192.168.1.3 (HTTP) ("GET /phpMyAdmin/scripts/setup.php HTTP/1.1")!</code></li>
</ol>

<h2>Getting Started on Kali Linux</h2>
<p>Assuming that you are <code>root</code>:</p>
<ol>
	<li>Install <code>libpcap</code> or later for packet injection (required by <code>pcaprub</code> and <code>packetfu</code>) via <code>sudo apt-get install libpcap*-dev</code></li>
	<li>Install the <code>pcaprub</code> gem which is required by <code>packetfu</code> via <code>gem install pcaprub</code></li>
	<li>Install the <code>packetfu</code> gem via <code>gem install packetfu</code></li>
	<li>(Not necessary but useful; can take a while to install) Install the <code>rdoc</code> gem for HTML and command-line documentation for Ruby projects: <code>gem install rdoc</code></li>
	<li>Here is a working live sniffer <code>alarm.rb</code> (change <code>eth0</code> to your interface):
			<pre>
require 'packetfu'

stream = PacketFu::Capture.new(:start => true, :iface => 'eth0', :promisc => true)
stream.show_live()
			</pre>
	</li>
	<li>To run: <code>sudo ruby alarm.rb</code> (or <code>ruby alarm.rb</code> if you are already root).</li>
	<li>Your job is to modify the program to detect incidents.</li>
</ol>

<h2>Running the Tool</h2>
<ol>
	<li>Running <code>sudo ruby alarm.rb</code> without any flags shall analyze live stream of network packets by default.</li>
	<li>Running <code>sudo ruby alarm.rb -r &lt;web_server_log&gt;</code> shall read in a web server log.  You can download a real web server log for your testing at <a href="http://www.cs.tufts.edu/comp/116/access.log.zip">http://www.cs.tufts.edu/comp/116/access.log.zip</a>.  You need to unzip the file first.  The <code>access.log</code> file has 4090 entries.</li>
</ol>
	
<h2>References</h2>
<h3>RubyGem Documentation for PacketFu</h3>
<p>While you can go to <a href="http://rubygems.org/" target="_blank">RubyGems.org</a> to get the API documentation for a gem, the documentation may be outdated.  The proper way is to run the gem server on your computer.</p>
<ol>
	<li>Run <code>gem server</code></li>
	<li>Go to <code>http://127.0.0.1:8808</code> on your web browser</li>
	<li>You will see a list of all the gems installed on your computer.  Go to the rdoc for <code>PacketFu</code></li>
</ol>

<h3>Additional Documentation</h3>
<ul>
	<li><a href="http://ruby-doc.org/docs/Tutorial/" target="_blank">Introduction to Ruby</a></li>
	<li><a href="http://tryruby.org/" target="_blank">TryRuby (interactive tutorial)</a></li>
	<li><a href="http://prezi.com/mw0_9qfb2d6d/packetfu-by-example/" target="_blank">"PacketFu by Example: A PacketFu Primer (presented at SharkFest 2011)" by Tod Beardsley</a></li>
	<li><a href="manipulatingthenetworkwithpacketfu-110314111058-phpapp01.pdf">Manipulating The Network with PacketFu (from Hakin9 Magazine, February 2010)</a></li>
	<li><a href="http://www.sans.org/security-resources/idfaq/snort-detect-credit-card-numbers.php" target="_blank">Detect Clear Text Credit Card Numbers (on SANS.org)</a> --please use these patterns in your program.</li>
	<li><a href="https://github.com/packetfu/packetfu" target="_blank">PacketFu (on GitHub)</a></li>
</ul>

<h2>The <code>README</code> File</h2>
<p>Every assignment shall include a <code>README</code> file that describes the work. This description must:</p>
<ul>
<li>Identify what aspects of the work have been correctly implemented and what have not.</li>
	<li>Identify anyone with whom you have collaborated or discussed the assignment.</li>
	<li>Say approximately how many hours you have spent completing the assignment.</li>
	<li>Be written in either text format (<code>README.txt</code>) or in Markdown (<code>README.md</code>). No other formats will be accepted.</li>
</ul>
<p>For this assignment, you must also address the following questions:</p>
<ol>
	<li>Are the heuristics used in this assignment to determine incidents "even that good"?</li>
	<li>If you have spare time in the future, what would you add to the program or do differently <em>with regards to detecting incidents</em>?</li>
</ol>
	
<h2>Submission</h2>
<p>Push <code>README</code> and your source code <code>alarm.rb</code> to the private repository that I created for you in a folder named <code>alarm</code>.  Say that your private repository is named <code>comp116-mchow</code>, make sure all the files are pushed to <code>comp116-mchow/alarm</code>.</p>

<h2>Assessment</h2>
<p>This assignment is worth 24 points.</p>
<ol>
	<li>(5 points) README</li>
	<li>(3 points) Basics (e.g., output format, followed usage instructions for tool, push work to <code>username/alarm</code> folder in private GitHub repository)</li>
	<li>(8 points) Program analyzes live network traffic for all specified incidents</li>
	<li>(8 points) Program analyzes web server log for all specified incidents</li>
	<li>(2 BONUS points) Your program supports reading PCAP files</li>
</ol>

</body>
</html>
